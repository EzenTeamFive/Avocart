console.log("전체 업체 개수 : " + listLength);
var remainder = listLength % 2;
console.log("나머지 : " + remainder);
//오른쪽 : 줄이기

if (remainder === 1) {
    $(document).ready(function () {
        $(".listContainer ul li:last-child").css("margin-right", "376px");
    });
}

let div = document.getElementById('resultZone');

//url 가져오기
const url = location.href;
//url에 type이라는 parmeter가 존재하는 경우
if(url.includes("type")) {
    if(listLength!=null) {
        div.innerText = "검색 결과 "+listLength+"개";
    } else {
        div.innerText = "검색 결과가 없습니다.";
    }
}

//파라미터에서 type, keyword, pageNo, qty 값 가져오기
const search = location.search;
const urlParams = new URLSearchParams(search);
const type = urlParams.get('type');
const keyword = urlParams.get('keyword');
let moreBtn = document.getElementById('moreBtn');
let pageNo = urlParams.get('pageNo');
let qty = urlParams.get('qty');

 if(pageNo == null || pageNo === "") {
     pageNo = moreBtn.dataset.pageNo;
 };

if(qty==null || qty === "") {
    qty = 8;
};

console.log("type : "+type);
console.log("keyword : "+keyword);
console.log("pageNo : "+pageNo);
console.log("qty : "+qty);

async function updateListFromServer(type, keyword, pageNo, qty){
    try{
        const resp = await fetch('/store/'+type+'/'+keyword+'/'+pageNo+'/'+qty);
        const result = await resp.json();
        return result;
    }catch(err){
        console.log(err);
    }
}

//더보기 버튼
if(pageNo<realEndPage) {
    moreBtn.style.visibility ='visible';
}

document.addEventListener('click', (e) => {
    if (e.target.id === 'moreBtn') {
        pageNo = pageNo + 1;
        updateListFromServer(type, keyword, pageNo, qty).then(result => {

            if (result.prodList.length > 0) {
                console.log(pageNo);
                const ul = document.getElementById('ulZone');
                if (pageNo === 1) {
                    ul.innerHTML = "";
                }

                for (let sbo of result.prodList) {
                    //li 생성
                    const li = document.createElement('li'); 
                    li.innerHTML = `
                        <a href="/store/detail?bno=${sbo.proBno}">
                            <div>
                                <div>
                                    <img class="profile" alt="사진" src="../resources/image/logoimage.png">
                                </div>
                            </div>
                            <div>
                                <div>
                                    <span class="title">${sbo.proTitle}</span>
                                    <span class="gray">주소</span>
                                </div>
                                <span class="content">${sbo.proContent}</span>
                                <span class="gray">${sbo.proMenu}</span>
                            </div>
                        </a>
                    `;
                    //li 추가
                    ul.appendChild(li);
                }
            }
        });
    }
});
